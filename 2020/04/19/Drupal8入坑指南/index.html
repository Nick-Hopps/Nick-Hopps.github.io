

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="A blog of NickHopps">
  <meta name="author" content="NickHopps">
  <meta name="keywords" content="Math, Computer-Science, Algorithm, Efficiency, Front-End, Back-End">
  
  <title>Drupal8 入坑指南 - Nick&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"infiniture.cn","root":"/","version":"1.8.9","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Nick's Blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                主页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://hexo-1251051422.cos.ap-guangzhou.myqcloud.com/bg-small.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Drupal8 入坑指南">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-04-19 13:56" pubdate>
        2020年4月19日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      7.2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      92
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Drupal8 入坑指南</h1>
            
            <div class="markdown-body">
              <h1 id="为什么选择-drupal"><a class="markdownIt-Anchor" href="#为什么选择-drupal"></a> 为什么选择 Drupal？</h1>
<p>我们先来看看3大开源 CMS 系统各自的主要特点：</p>
<p>WordPress：</p>
<ul>
<li>用户友好，非常适合非开发人员</li>
<li>免费和付费的插件、主题数量庞大</li>
<li>拥有最活跃的社区（WP市场占有率60%以上）</li>
<li>优秀的本地化支持</li>
</ul>
<p>Joomla：</p>
<ul>
<li>注重用户友好的同时，兼顾了自定义开发，平衡了 WP 和 Drupal 各自的优点</li>
<li>优秀的本地化支持</li>
</ul>
<p>Drupal：</p>
<ul>
<li>强大的自定义开发支持，非常适合开发人员</li>
<li>支持CLI命令行工具</li>
</ul>
<p>其实只要稍微作对比就会发现，如果没有特殊的需求，开发的首选依然是 WordPress。但是也显而易见，用户友好的代价就是缺乏一定的灵活性，比如说我已经规划好了整个网站的架构，然后发现如果需要用 WordPress 来实现的话，需要各种各样的插件支持，这样反而提升了开发的复杂度。这也是为什么我会选择 Drupal。如果说 WordPress 是一台完美组装好的强力赛车，那 Drupal 就是一辆底盘优秀，但是其余部件都要自己选择并组装的赛车，其突出的特点就是可配置性。</p>
<h1 id="从哪里获取资料"><a class="markdownIt-Anchor" href="#从哪里获取资料"></a> 从哪里获取资料？</h1>
<p>尽管 Drupal 的功能非常强大，但是它所占的市场规模实在是太小了（3%左右），因此国内的相关资料少得可怜，百度直接找到的活跃社区，就是<a target="_blank" rel="noopener" href="http://drupalchina.cn/">Drupal中国</a>，但是上面的学习资料太散了，不适合入门学习，后来只能回归官方文档。学习了几天之后，感觉非常吃力，不仅仅因为是英文，而且官方的文档就是一本说明书，不是教程。类似的还有社区文档，社区的文档的参考价值比官方文档高，不过依然不够完善，进一步搜索后，才找到了我真正需要的东西：</p>
<h2 id="初探掌握-drupal-的使用方法"><a class="markdownIt-Anchor" href="#初探掌握-drupal-的使用方法"></a> 初探——掌握 Drupal 的使用方法</h2>
<p>《Beginning Drupal 8》：Todd Tomlinson 写的一本用来入门 Drupal 的书，Google 搜索 PDF 可以直接找到，有概念有实践。粗略浏览一遍就能对 Drupal 有一个整体的印象，之后再结合 Drupal 的社区文档进行学习，就容易消化多了。</p>
<h2 id="进阶掌握-drupal-的开发方法"><a class="markdownIt-Anchor" href="#进阶掌握-drupal-的开发方法"></a> 进阶——掌握 Drupal 的开发方法</h2>
<p>开发资料，最基础的依然是社区开发文档，比如<a target="_blank" rel="noopener" href="https://www.drupal.org/docs/8/theming">Theming Drupal 8</a>，然后配合 <strong>Packt</strong>上的两本书：《Drupal 8 Theming with Twig》和 《Matering Drupal 8》，就可以掌握最基本的开发方法和步骤了。</p>
<p>可惜的是，到目前为止，并没有找到有价值的中文资料，有待补充。当然，除了文档和书籍，官方论坛也是个好地方，一般用来解决开发过程中遇到的各式各样的问题。</p>
<h1 id="上手-drupal"><a class="markdownIt-Anchor" href="#上手-drupal"></a> 上手 Drupal</h1>
<p>关于开发环境一类的搭建就不多赘述了，能选择 Drupal 进行开发的，基本也都是老手了。唯一需要注意的一点是，注意 php 和 mysql 的配置，比如我是 Windows 平台上用 XAMPP 搭建的环境，就参考 <a target="_blank" rel="noopener" href="https://www.drupal.org/docs/develop/local-server-setup/windows-development-environment/quick-install-drupal-with-xampp-on">Quick install Drupal with XAMPP on Windows</a> 进行配置。</p>
<h2 id="drupal-的目录结构"><a class="markdownIt-Anchor" href="#drupal-的目录结构"></a> Drupal 的目录结构</h2>
<p>了解一个项目最好的出发点，就是先了解它的组成结构。前面也说到了，通过 Composer 直接安装的项目，Drupal 的主要文件位于 “/web” 目录下，而 “/vendor” 目录下则是这个 Drupal 发行版所需的各种依赖。Drupal 的主要文件结构如下所示：</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs axapta">├── core                              <span class="hljs-meta"># Drupal 核心部分</span><br>│   ├── assets<br>│   ├── config<br>│   ├── includes<br>│   ├── lib                           <span class="hljs-meta"># Drupal 核心依赖库</span><br>│   ├── misc<br>│   ├── modules                       <span class="hljs-meta"># Drupal 核心模块</span><br>│   ├── profiles                      <span class="hljs-meta"># Drupal 安装配置</span><br>│   ├── scripts                       <span class="hljs-meta"># Drupal CLI脚本</span><br>│   ├── tests<br>│   ├── themes                        <span class="hljs-meta"># Drupal 默认主题</span><br>│   └── ...<br>├── modules                           <span class="hljs-meta"># Contributed/Custom 模块</span><br>├── profiles                          <span class="hljs-meta"># Distribution/Custom 安装配置</span><br>├── sites<br>│   ├── <span class="hljs-literal">default</span><br>│   │ 	├── files                     <span class="hljs-meta"># 站点文件（包含图片、CSS、JS、导出的配置、语言等）</span><br>│   │ 	├── <span class="hljs-literal">default</span>.services.yml<br>│   │ 	├── <span class="hljs-literal">default</span>.settings.php<br>│   │ 	└── settings.php              <span class="hljs-meta"># 站点设置文件（数据库、代理、PHP设置等）</span><br>│   └── ...<br>├── themes                            <span class="hljs-meta">#	Contributed/Custom 主题</span><br>├── INSTALL.txt<br>├── README.txt<br>├── autoload.php                      <span class="hljs-meta"># 加载依赖</span><br>├── example.gitignore<br>├── <span class="hljs-keyword">index</span>.php                         <span class="hljs-meta"># 主入口文件</span><br>├── robots.txt<br>├── update.php                        <span class="hljs-meta"># 数据库升级</span><br>└── web.config<br></code></pre></td></tr></table></figure>
<h2 id="安装-drupal"><a class="markdownIt-Anchor" href="#安装-drupal"></a> 安装 Drupal</h2>
<p>建议使用 Composer 安装 Drupal，以便随后可以通过 Composer 管理整个项目。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 如果下载太慢可以尝试替换阿里云的镜像源或者使用代理</span><br>composer create-project drupal/recommended-project my_site_dir<br><br><span class="hljs-meta">#</span><span class="bash"> 安装完本体后别忘了把 drush 也装上（drush 是 drupal 的命令行工具）</span><br>composer require drush/drush<br></code></pre></td></tr></table></figure>
<p>需要注意的是，由于新版本的 Drupal 考虑到安全性，把网站根目录和依赖分别放在两个不同的目录（/web 和 /vendor）中，因此在服务器部署的时候，需要注意文件所在位置，这个坑比较麻烦，这里举个例子：</p>
<p>比如我有一个项目需要部署在一个共享云主机上面，由于只能通过 FTP 访问网站根目录，没法配置 Apache，因此只有两种方法，一是使用官网直接下载的版本（core 和 vendor 在同一目录下），二是通过 RewriteRule 改写当前路径。考虑到安全问题，我们还是使用根目录和依赖分开的目录结构，为此需要配置 .htaccess 文件（假设目前根目录为 drupal）：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># example.com/.htaccess</span><br><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteEngine</span></span> <span class="hljs-literal">on</span><br><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteCond</span></span> <span class="hljs-variable">%&#123;HTTP_HOST&#125;</span> ^www.example.com$<span class="hljs-meta"> [NC,OR]</span><br><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteCond</span></span> <span class="hljs-variable">%&#123;HTTP_HOST&#125;</span> ^example.com$<br><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteRule</span></span> ^$ web/$<span class="hljs-number">1</span><span class="hljs-meta"> [L]</span><br><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteCond</span></span> <span class="hljs-variable">%&#123;REQUEST_FILENAME&#125;</span> !-d<br><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteCond</span></span> <span class="hljs-variable">%&#123;REQUEST_FILENAME&#125;</span> !-f<br><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteRule</span></span> (.*) web/$<span class="hljs-number">1</span><span class="hljs-meta"> [L]</span><br></code></pre></td></tr></table></figure>
<p>这样一来，只要我访问 <a target="_blank" rel="noopener" href="http://example.com">example.com</a> 就相当于访问 <a target="_blank" rel="noopener" href="http://example.com/web%E3%80%82%E4%B8%8D%E8%BF%87%E6%AD%A4%E6%97%B6%E8%BF%98%E6%9C%89%E5%8F%AF%E8%83%BD%E4%BC%9A%E9%81%87%E5%88%B0%E9%97%AE%E9%A2%98%EF%BC%8C%E9%9C%80%E8%A6%81%E5%9C%A8">example.com/web。不过此时还有可能会遇到问题，需要在</a> “site/default/setting.php” 种加上一句：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;request&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;/web/index.php&#x27;</span> === <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;request&#x27;</span>]-&gt;server-&gt;get(<span class="hljs-string">&#x27;SCRIPT_NAME&#x27;</span>)) &#123;<br>  <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;request&#x27;</span>]-&gt;server-&gt;set(<span class="hljs-string">&#x27;SCRIPT_NAME&#x27;</span>, <span class="hljs-string">&#x27;/index.php&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>如果不这样的话，&quot;/web/index.php&quot; 就会在根目录被 Rewrite 一次，导致找不到页面，而至于 “/web/.htaccess”，可以完全不用管它。</p>
<p>和 WordPress 一样，通过直接访问站点的方式进行安装，除此之外 Drupal 还支持通过 Drush 进行命令行安装。安装的第一步需要选择语言，建议先默认使用英文安装，中文安装有时候会失败，原因是下载超时，当然也有解决方法：</p>
<p>在 <code>core/lib/Drupal/Core/Http/ClientFactory.php</code> 50行的位置，修改超时或者设置代理即可解决问题：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$default_config</span> = [<br>  <span class="hljs-comment">// Security consideration: we must not use the certificate authority</span><br>  <span class="hljs-comment">// file shipped with Guzzle because it can easily get outdated if a</span><br>  <span class="hljs-comment">// certificate authority is hacked. Instead, we rely on the certificate</span><br>  <span class="hljs-comment">// authority file provided by the operating system which is more likely</span><br>  <span class="hljs-comment">// going to be updated in a timely fashion. This overrides the default</span><br>  <span class="hljs-comment">// path to the pem file bundled with Guzzle.</span><br>  <span class="hljs-string">&#x27;verify&#x27;</span> =&gt; <span class="hljs-literal">TRUE</span>,<br>  <span class="hljs-string">&#x27;timeout&#x27;</span> =&gt; <span class="hljs-number">30</span>, <span class="hljs-comment"># 这里修改为 300 或者更高</span><br>  <span class="hljs-string">&#x27;headers&#x27;</span> =&gt; [<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span> =&gt; <span class="hljs-string">&#x27;Drupal/&#x27;</span> . \Drupal::VERSION . <span class="hljs-string">&#x27; (+https://www.drupal.org/) &#x27;</span> . \GuzzleHttp\default_user_agent(),<br>  ],<br>  <span class="hljs-string">&#x27;handler&#x27;</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;stack,<br>  <span class="hljs-comment">// Security consideration: prevent Guzzle from using environment variables</span><br>  <span class="hljs-comment">// to configure the outbound proxy.</span><br>  <span class="hljs-string">&#x27;proxy&#x27;</span> =&gt; [<br>    <span class="hljs-string">&#x27;http&#x27;</span> =&gt; <span class="hljs-literal">NULL</span>,<br>    <span class="hljs-string">&#x27;https&#x27;</span> =&gt; <span class="hljs-literal">NULL</span>,<br>    <span class="hljs-string">&#x27;no&#x27;</span> =&gt; [],<br>  ],<br>];<br></code></pre></td></tr></table></figure>
<p>如果默认使用英文安装，则可以在安装完成后手动启动 Language 和 Interface Translation 两个模块，接着去官网下载语言包，在 Interface Translation 的配置中导入下载的语言包，最后去 Language 配置中设置默认语言为中文即可。</p>
<h2 id="介绍常用功能"><a class="markdownIt-Anchor" href="#介绍常用功能"></a> 介绍常用功能</h2>
<p>为了方便理解，以下演示的语言都设置为英文。安装完成后会自动跳转到首页，此时可以在页头看到一个工具栏，这个工具栏只有登录后才会显示。在 Drupal 中，登录后台最直接的方式就是在 URL 后面加上 “/user”，登录之后会跳转到用户的个人页面，此时便可以通过工具栏访问不同的栏目了。</p>
<p><img src="https://hexo-1251051422.cos.ap-guangzhou.myqcloud.com/Drupal8%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/image-20200418004526170.png" srcset="/img/loading.gif" lazyload alt="image-20200418004526170" /></p>
<p>Drupal 的主要功能区如上图所示：</p>
<ul>
<li>Content（内容）：管理文章和媒体</li>
<li>Structure（结构）：管理区块、内容类型、菜单、分类、视图</li>
<li>Appearance（外观）：管理主题</li>
<li>Extend（扩展）：管理模块</li>
<li>Configuration（配置）：配置站点、语言等</li>
<li>People（人员）：管理用户</li>
<li>Reports（报告）：查看更新以及日志</li>
<li>Help（帮助）：查看模块帮助</li>
</ul>
<h3 id="内容类型"><a class="markdownIt-Anchor" href="#内容类型"></a> 内容类型</h3>
<p>作为CMS，首先最关心的应该是如何添加页面和内容。内容的话，首先添加站点所需的内容类型，Drupal 特别优秀的一点就是对内容类型的字段操作。</p>
<p><img src="https://hexo-1251051422.cos.ap-guangzhou.myqcloud.com/Drupal8%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/image-20200418180947890.png" srcset="/img/loading.gif" lazyload alt="image-20200418180947890" /></p>
<p>添加自定义字段后，可以通过 “Manage form display” 管理添加的这些字段在创建内容时显示的可见性、顺序以及格式（Format：用来限定字段的数据类型、显示格式等），而 “Manage display” 则是管理对应内容类型展示给用户的内容的可见性、顺序以及格式。</p>
<h3 id="页面和区块"><a class="markdownIt-Anchor" href="#页面和区块"></a> 页面和区块</h3>
<p>对于页面，Drupal 有两种常见的创建页面方式：视图（Views） 和页面管理器（Page Manager UI）。二者都调用了 Page Manager 模块，区别在于视图是集成到 Drupal 核心的，安装好 Drupal 之后就可以使用，而页面管理器是一个额外的模块，需要额外安装。无论通过哪种方式创建页面，都需要调用该页面的模板（page–suggestion.html.twig，后面主题开发会介绍），模板上会指定内容显示的区域（Region），光创建好页面是没有用的，还需要指定访问该页面的 URL 以及在页面对应的区域中布置区块（Block）：</p>
<p><img src="https://hexo-1251051422.cos.ap-guangzhou.myqcloud.com/Drupal8%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/image-20200418213934941.png" srcset="/img/loading.gif" lazyload alt="image-20200418213934941" /></p>
<p>页面的模板往往是由主题指定的，因此不同的主题会有不同的区块布局（Block Layout）。区块分为系统自带的区块（Core、System、Menus等）和自定义区块（Custom），网页上的所有内容，都是区块，举个列子：在内容（Contnet）中创建的文章，其实都是通过 “Main page content” 这个系统区块添加到页面中的。因此，如果你有一段 HTML 代码需要添加到页面的对应位置，那么在自定义区块库（Custom block library）中添加一个自定义区块即可（补充：由于区块本质也是内容，因此在自定义区块库中也可以创建自己想要的区块类型，比如我可以指定某类区块都是富文本而另一类区块都是纯 HTML。）</p>
<p>至此，Drupal 添加页面和内容的流程就很清晰了：</p>
<p><img src="https://hexo-1251051422.cos.ap-guangzhou.myqcloud.com/Drupal8%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/image-20200419002431476.png" srcset="/img/loading.gif" lazyload alt="image-20200419002431476" /></p>
<h3 id="视图"><a class="markdownIt-Anchor" href="#视图"></a> 视图</h3>
<p>前面说了，创建页面可以用视图或者页面管理器，实际上视图是页面管理器的超集，因此只需掌握如何使用视图创建页面就够了。</p>
<p><img src="https://hexo-1251051422.cos.ap-guangzhou.myqcloud.com/Drupal8%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/image-20200418221017604.png" srcset="/img/loading.gif" lazyload alt="image-20200418221017604" /></p>
<p>从视图（Views）进来，就可以发现，实际上包括 Drupal 的后台页面在内，都是一个个的视图组成的。创建视图也是学习 Drupal 的路上遇到的第一个硬骨头。选择 “Add view” 来添加一个视图，我们可以指定视图要显示的内容以及视图呈现的形式（Display）：作为一个页面或者作为一个区块，之后就会进入视图的详细设置页面。接下来以首页（Frontpage）为例来看看视图中具体的设置。</p>
<p><img src="https://hexo-1251051422.cos.ap-guangzhou.myqcloud.com/Drupal8%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/image-20200418223519270.png" srcset="/img/loading.gif" lazyload alt="image-20200418223519270" /></p>
<p>首先是显示（Display），这是视图最好用的功能，你可以给选定内容不同的显示方式，比如页面（Page）、区块（Block）、摘要（Teaser）这三种最常用的显示方式（除此之外还有附件（Attachment）、嵌入（Embed）、实体引用（Entity Reference）以及信息聚合（Feed）），如果有特殊需要，你还可以自定义一种显示方式（     在 Structure-&gt;Display modes -&gt;View modes 中）。这个功能最常见的应用，就是在首页只显示文章的摘要（Teaser），点击标题后进入文章页查看全文（Default）。</p>
<blockquote>
<p>注：默认显示（Default）一般是不可见的，如果需要更改默认显示，要先在视图的设置中勾选上：Always show the master (default) display</p>
</blockquote>
<p>视图里面一般需要配置的项目有：</p>
<ul>
<li>格式（FORMAT）
<ul>
<li>Format：设置内容显示的方式，Unformatied list 就是用 <code>&lt;div&gt;</code> 标签包裹内容；</li>
<li>Show：设置显示具体的内容（Content）还是只显示字段（Field），如果显示具体内容，后面还可以设置内容的显示方式。</li>
</ul>
</li>
<li>字段（FIELDS）
<ul>
<li>如果上面设置只显示字段，那么就可以在这里添加需要显示的字段。</li>
</ul>
</li>
<li>过滤器（FILTER）
<ul>
<li>过滤内容，可以多个条件组合使用。</li>
</ul>
</li>
<li>排序（SORT）
<ul>
<li>对内容显示进行排序。</li>
</ul>
</li>
<li>页面/块设置（PAGE/BLOCK SETTINGS）
<ul>
<li>设置页面的路径（即 URL）、所属菜单等信息。</li>
</ul>
</li>
<li>分页（PAGER）
<ul>
<li>Use pager：设置是否使用分页器以及分页的样式、每页显示的数量等；</li>
<li>More link：设置是否在分页器后显示 “more” 链接，点击该链接即查看全部内容。</li>
</ul>
</li>
<li>上下文过滤器（CONTEXTUAL FILTERS）
<ul>
<li>配合当前 URL 中提供的信息进行内容过滤。</li>
</ul>
</li>
<li>联系（RELATIONSHIPS）
<ul>
<li>和其他实体建立联系，比如和分类（Taxonomy）建立联系，然后便可以配合上下文过滤器实现通过分类名称来过滤内容。</li>
</ul>
</li>
</ul>
<h3 id="分类和菜单"><a class="markdownIt-Anchor" href="#分类和菜单"></a> 分类和菜单</h3>
<p>说到分类（Taxonomy）和菜单（Menus），如果有使用 WordPress 的经验，那么应该对这两个东西不陌生了。同样还是举例子吧，在 Drupal 中，可以使用分类来实现文章标签的功能：</p>
<p><img src="https://hexo-1251051422.cos.ap-guangzhou.myqcloud.com/Drupal8%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/image-20200418234159320.png" srcset="/img/loading.gif" lazyload alt="image-20200418234159320" /></p>
<p>首先在分类页面下新建一个词汇 “标签（Tags）”，之后再这个词汇下建立多个术语（terms），对应不同的文章类型。之后在对应文章的文章类型中，新增一个字段，用来添加这个标签：</p>
<p><img src="https://hexo-1251051422.cos.ap-guangzhou.myqcloud.com/Drupal8%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/image-20200418234419794.png" srcset="/img/loading.gif" lazyload alt="image-20200418234419794" />最后在创建文章的时候，选择或者填写预先设置好的标签即可。假如还需要给不同的标签创建一个归档页，则利用上面讲到的视图：新建一个视图，过滤器选择对应分类术语即可。（实际上 Drupal 自带归档页视图，只不过没有启用，在视图页的 “Disabled” 栏目下面）</p>
<p>Drupal 默认有 5 个菜单，这 5 个菜单只可以编辑不可以删除：</p>
<p><img src="https://hexo-1251051422.cos.ap-guangzhou.myqcloud.com/Drupal8%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/image-20200418235126300.png" srcset="/img/loading.gif" lazyload alt="image-20200418235126300" /></p>
<p>以管理菜单（Administration ）为例：</p>
<p><img src="https://hexo-1251051422.cos.ap-guangzhou.myqcloud.com/Drupal8%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/image-20200418235305417.png" srcset="/img/loading.gif" lazyload alt="image-20200418235305417" /></p>
<p>可以通过 “Add link” 添加菜单项目，然后通过菜单项前面的符号拖动菜单项排序和分级。每个菜单项本质是其对应页面的链接。因此我们现在可以更新一下上面说到的 Drupal 添加页面和内容的流程：</p>
<p><img src="https://hexo-1251051422.cos.ap-guangzhou.myqcloud.com/Drupal8%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/image-20200419002400379.png" srcset="/img/loading.gif" lazyload alt="image-20200419002400379" /></p>
<h2 id="介绍常用模块不间断更新"><a class="markdownIt-Anchor" href="#介绍常用模块不间断更新"></a> 介绍常用模块（不间断更新）</h2>
<h3 id="系统管理"><a class="markdownIt-Anchor" href="#系统管理"></a> 系统管理</h3>
<ul>
<li>Allowed Formats：添加内容类型的 Body 字段时，指定可用的文本编辑器。</li>
<li>Business Rules：Drupal 8.X 以上版本对 Rules 模块的替代，用来实现根据不同“条件（Condition）”执行对应的“动作（Action）”，比 Rules 模块好用。</li>
<li>Structure Sync：允许导出菜单、分类、自定义区块。</li>
<li>Configuration Partial Export：允许到处单个或者多个配置。</li>
<li>Admin Toolbar：允许 Toolbar 显示下拉菜单。</li>
<li>Rename Admin Paths：允许重命名登录和后台管理页面的路径，默认为 “/user” 和 “/admin”。</li>
<li>Display Suite：允许对内容类型的字段进行分栏，提供多栏显示的功能。</li>
</ul>
<h3 id="内容创作"><a class="markdownIt-Anchor" href="#内容创作"></a> 内容创作</h3>
<ul>
<li>Blazy：提供图片懒加载功能。</li>
<li>Gutenburg：WordPress 古腾堡编辑器。</li>
<li>Views Infinite Scroll：无限滚动分页。</li>
<li>Metatag：提供页面或者内容的元信息，方便 SEO。</li>
<li>Layout Builder：提供可视化的显示方式编辑（Manage display）</li>
<li>ImageWidgetCrop：提供图片剪切的功能。</li>
<li>Background Images Formatter：格式化 CSS 中使用的背景图片。</li>
</ul>
<h1 id="主题开发"><a class="markdownIt-Anchor" href="#主题开发"></a> 主题开发</h1>
<h2 id="名词解释"><a class="markdownIt-Anchor" href="#名词解释"></a> 名词解释</h2>
<ul>
<li>Entity：Drupal 管理的一切内容都是实体（Entity），包括 Nodes、Users 、Comments等；</li>
<li>Nodes：Drupal 上的所有内容均被存储并视为结点（Node），Node 可以是任何内容，例如页面，文章；</li>
<li>Field：可以添加到元素的数据字段，例如标题，正文，注释，标签，图像；</li>
<li>theme hook suggestions：Drupal确定模板文件可以使用的名称的过程，类似于 Wordpress 决定使用哪个页面模板的过程。</li>
</ul>
<h2 id="主题的文件结构"><a class="markdownIt-Anchor" href="#主题的文件结构"></a> 主题的文件结构</h2>
<p>自定义的主题建议放在 <code>/themes/custom/</code> 下面 （非必须）</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">|<span class="hljs-string">-*.info.yml          // 定义元数据，全局库和区域块</span><br>|<span class="hljs-string">-*.libraries.yml     // 定义主题可以加载的 JS/CSS 库</span><br>|<span class="hljs-string">-*.breakpoints.yml   // 定义响应式断点（仅当Drupal需要与断点进行交互时）</span><br>|<span class="hljs-string">-*.theme             // 定义条件逻辑、数据预处理以及扩展基本主题设置</span><br>|<span class="hljs-string">-templates           // 定义主题页面模板</span><br>|<span class="hljs-string">  </span>|<span class="hljs-string">-maintenance-page.html.twig</span><br>|<span class="hljs-string">  </span>|<span class="hljs-string">-node.html.twig</span><br>|<span class="hljs-string">-config              // 定义主题所需的各种变量</span><br>|<span class="hljs-string">  </span>|<span class="hljs-string">-install</span><br>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">-*.settings.yml</span><br>|<span class="hljs-string">  </span>|<span class="hljs-string">-schema</span><br>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">-*.schema.yml</span><br>|<span class="hljs-string">-css</span><br>|<span class="hljs-string">  </span>|<span class="hljs-string">-style.css</span><br>|<span class="hljs-string">-js</span><br>|<span class="hljs-string">  </span>|<span class="hljs-string">-script.js</span><br>|<span class="hljs-string">-images</span><br>|<span class="hljs-string">  </span>|<span class="hljs-string">-buttons.png</span><br>|<span class="hljs-string">-logo.svg</span><br>|<span class="hljs-string">-screenshot.png</span><br></code></pre></td></tr></table></figure>
<h2 id="编写-infoyml-文件"><a class="markdownIt-Anchor" href="#编写-infoyml-文件"></a> 编写 <code>*.info.yml</code> 文件</h2>
<p>必需属性：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">name:</span> <span class="hljs-string">xxxxx</span>   <span class="hljs-string">//</span> <span class="hljs-string">主题的名字，用来显示在“外观”菜单中</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">theme</span>   <span class="hljs-string">//</span> <span class="hljs-string">指明类型为</span> <span class="hljs-string">theme</span> <span class="hljs-string">而非</span> <span class="hljs-string">module</span> <span class="hljs-string">或者</span> <span class="hljs-string">profile</span><br><span class="hljs-attr">core:</span> <span class="hljs-number">8.</span><span class="hljs-string">x</span>     <span class="hljs-string">//</span> <span class="hljs-string">指明</span> <span class="hljs-string">Drupal</span> <span class="hljs-string">Core</span> <span class="hljs-string">的版本</span><br></code></pre></td></tr></table></figure>
<p>可选属性：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">description:</span> <span class="hljs-string">xxxxxx</span> <span class="hljs-string">//</span> <span class="hljs-string">主题的描述</span><br><span class="hljs-attr">package:</span> <span class="hljs-string">Core</span>       <span class="hljs-string">//</span> <span class="hljs-string">指定主题的分组</span><br><span class="hljs-attr">php:</span> <span class="hljs-string">x.x.x</span>          <span class="hljs-string">//</span> <span class="hljs-string">所需最低版本的</span> <span class="hljs-string">PHP</span><br><span class="hljs-attr">version:</span> <span class="hljs-string">x.x.x</span>      <span class="hljs-string">//</span> <span class="hljs-string">给主题指定一个版本</span><br><span class="hljs-attr">base theme:</span> <span class="hljs-string">classy</span>  <span class="hljs-string">//</span> <span class="hljs-string">继承某个主题的资源</span><br><span class="hljs-attr">logo:</span> <span class="hljs-string">xxx</span>           <span class="hljs-string">//</span> <span class="hljs-string">指定主题LOGO</span><br><span class="hljs-attr">screenshot:</span> <span class="hljs-string">xxx</span>     <span class="hljs-string">//</span> <span class="hljs-string">指定主题缩略图（588x438）</span><br><span class="hljs-attr">features:</span>           <span class="hljs-string">//</span> <span class="hljs-string">指定要在主题“设置”页面上显示的功能列表</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">comment_user_verification</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">comment_user_picture</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">favicon</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">logo</span><br><br><span class="hljs-attr">ckeditor_stylesheets:</span> <span class="hljs-string">//</span> <span class="hljs-string">定义</span> <span class="hljs-string">CKEditor</span> <span class="hljs-string">的样式</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">https://fonts.googleapis.com/css?family=Open+Sans</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">css/base/elements.css</span><br><br><span class="hljs-attr">regions:</span>              <span class="hljs-string">//</span> <span class="hljs-string">指定主题的区域（注意没有横杠）</span><br>  <span class="hljs-attr">header:</span> <span class="hljs-string">Header</span><br>  <span class="hljs-attr">content:</span> <span class="hljs-string">Content</span><br>  <span class="hljs-attr">sidebar_first:</span> <span class="hljs-string">&#x27;First sidebar&#x27;</span><br><span class="hljs-attr">regions_hidden:</span>       <span class="hljs-string">//</span> <span class="hljs-string">指定要移除的区域（这里有横杠）</span><br>	<span class="hljs-bullet">-</span> <span class="hljs-string">sidebar_last</span><br><br><span class="hljs-attr">libraries:</span>            <span class="hljs-string">//</span> <span class="hljs-string">启用主题时加载的</span> <span class="hljs-string">CSS/JS</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">*/global-styling</span><br><br><span class="hljs-attr">libraries-override:</span>   <span class="hljs-string">//</span> <span class="hljs-string">启用主题时覆盖原本的</span> <span class="hljs-string">CSS/JS</span><br>  <span class="hljs-attr">contextual/drupal.contextual-links:</span><br>    <span class="hljs-attr">css:</span><br>      <span class="hljs-attr">component:</span>      <span class="hljs-string">//</span> <span class="hljs-string">上面三个部分都是对应库的</span> <span class="hljs-string">namespace</span><br>        <span class="hljs-string">/core/themes/stable/css/contextual/contextual.module.css:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-attr">libraries-extend:</span>     <span class="hljs-string">//</span> <span class="hljs-string">当某个库加载的同时额外加载的库</span><br>  <span class="hljs-attr">core/drupal.user:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">classy/user1</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">classy/user2</span><br></code></pre></td></tr></table></figure>
<p>其他还有 <code>hidden</code>、<code>engine</code>等可选属性</p>
<h3 id="设置区域块"><a class="markdownIt-Anchor" href="#设置区域块"></a> 设置区域块</h3>
<p>设置区域块包含两个步骤：</p>
<ul>
<li>将区域元数据添加到 THEMENAME.info.yml 文件；</li>
<li>将定义的区域输出到 page.html.twig 文件。</li>
</ul>
<blockquote>
<p>注：如果在主题中声明任何区域，将会使默认区域无效，因此这种情况下需要自己声明所有区域</p>
</blockquote>
<p>默认区域：</p>
<ol>
<li>page.header</li>
<li>page.primary_menu</li>
<li>page.secondary_menu</li>
<li>page.highlighted</li>
<li>page.help (dynamic help text, mostly for admin pages)</li>
<li>page.content (main content of current page)</li>
<li>page.sidebar_first</li>
<li>page.sidebar_second</li>
<li>page.footer</li>
<li>page.breadcrumb</li>
</ol>
<p>首先需要在 <code>*.info.yml</code> 中指定所需的 <code>regions</code>，比如：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">regions:</span><br>  <span class="hljs-attr">header:</span> <span class="hljs-string">&#x27;Header&#x27;</span><br>  <span class="hljs-attr">content:</span> <span class="hljs-string">&#x27;Content&#x27;</span><br>  <span class="hljs-attr">footer:</span> <span class="hljs-string">&#x27;Footer&#x27;</span><br></code></pre></td></tr></table></figure>
<p>之后就需要在 <code>templates/page.html.twig</code> 中添加定义的区域：</p>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="hljs-template-variable">&#123;&#123; page.header &#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><code>page</code> 为所定义区域的命名空间</p>
<h3 id="加载-css-和-js-资源"><a class="markdownIt-Anchor" href="#加载-css-和-js-资源"></a> 加载 CSS 和 JS 资源</h3>
<p>加载 CSS 和 JS 包含两个步骤：</p>
<ul>
<li>在 <code>* .libraries.yml</code> 文件中定义所有库；</li>
<li>将库附加到所有页面或者特定页面。</li>
</ul>
<p>首先在 <code>*.libraries.yml</code> 中<strong>声明</strong>需要使用的库（CSS/JS），如下所示，<code>&#123;&#125;</code> 内部可以定义各种参数，具体参考：<em><a target="_blank" rel="noopener" href="https://www.drupal.org/docs/8/theming/adding-stylesheets-css-and-javascript-js-to-a-drupal-8-theme#libraries-options-details">Defining Libraries: Options &amp; Details</a></em>：</p>
<blockquote>
<p>注意： <code>*.info.yml</code> 中 <code>libraries</code> 所定义的库会应用于所有主题页面</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">cuddly-slider:</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-number">1.</span><span class="hljs-string">x</span><br>  <span class="hljs-attr">css:</span><br>    <span class="hljs-attr">theme:</span><br>      <span class="hljs-attr">css/cuddly-slider.css:</span> &#123;&#125;<br>  <span class="hljs-attr">js:</span><br>    <span class="hljs-attr">js/cuddly-slider.js:</span> &#123;&#125;<br>    <span class="hljs-attr">dependencies:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">core/jquery</span><br><br><span class="hljs-attr">global-styling:</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-number">1.</span><span class="hljs-string">x</span><br>  <span class="hljs-attr">css:</span><br>    <span class="hljs-attr">theme:</span><br>      <span class="hljs-attr">css/layout.css:</span> &#123;&#125;<br>      <span class="hljs-attr">css/style.css:</span> &#123;&#125;<br>      <span class="hljs-attr">css/colors.css:</span> &#123;&#125;<br><br><span class="hljs-attr">global-scripts:</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-number">1.</span><span class="hljs-string">x</span><br>  <span class="hljs-attr">js:</span><br>    <span class="hljs-attr">js/navmenu.js:</span> &#123;&#125;<br></code></pre></td></tr></table></figure>
<p>在这个例子中，cuddly-slider.js 储存在 <code>js/</code> 目录中，cuddly-slider.css 储存在 <code>css/</code> 目录中。默认情况下，Drupal 8 不再在所有页面上加载 jQuery，因此需要指定 <code>dependencies</code>，由于 Drupal 的 Core 包含了 jQuery，因此只需要指定 <code>core/jquery</code> 即可，对于其他需要使用的依赖，按照 <code>resource/library</code>  的格式引用即可</p>
<p>关于 <code>css</code> 中的 <code>theme</code>，表示 css 文件所属的样式类型，共有 5 种不同的样式类型，不同的样式类型有不同的 CSS 权重：</p>
<ul>
<li><code>base</code>: CSS reset/normalize plus HTML element styling. Key assigns a weight of <code>CSS_BASE = -200</code></li>
<li><code>layout</code>: macro arrangement of a web page, including any grid systems. Key assigns a weight of <code>CSS_LAYOUT = -100</code></li>
<li><code>component</code>: discrete, reusable UI elements. Key assigns a weight of <code>CSS_COMPONENT = 0</code></li>
<li><code>state</code>: styles that deal with client-side changes to components. Key assigns a weight of <code>CSS_STATE = 100</code></li>
<li><code>theme</code>: purely visual styling (“look-and-feel”) for a component. Key assigns a weight of <code>CSS_THEME = 200</code></li>
</ul>
<h4 id="将库应用到所有页面"><a class="markdownIt-Anchor" href="#将库应用到所有页面"></a> 将库应用到所有页面</h4>
<p>在 <code>*.info.yml</code> 的 <code>libraries</code> 中添加所需的全局库：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">libraries:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">*/global-styling</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">*/global-scripts</span><br></code></pre></td></tr></table></figure>
<h4 id="将库应用到部分页面"><a class="markdownIt-Anchor" href="#将库应用到部分页面"></a> 将库应用到部分页面</h4>
<p>在 <code>*.theme</code> 文件中使用钩子函数 <code>THEME.preprocess_HOOK()</code> ，其中 <code>THEME</code> 是主题名，<code>HOOK</code> 是需要加载库的页面名：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fluffiness_preprocess_maintenance_page</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$variables</span></span>) </span>&#123;<br>  <span class="hljs-variable">$variables</span>[<span class="hljs-string">&#x27;#attached&#x27;</span>][<span class="hljs-string">&#x27;library&#x27;</span>][] = <span class="hljs-string">&#x27;fluffiness/cuddly-slider&#x27;</span>;<br>&#125; <span class="hljs-comment">// 在维护页面中加载“fluffiness/cuddly-slider”库</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意：除了上述方法，还可以在 Twig 模板中使用 <code>attach_library()</code> 函数加载库</p>
</blockquote>
<h3 id="设置断点"><a class="markdownIt-Anchor" href="#设置断点"></a> 设置断点</h3>
<blockquote>
<p>注意：仅当 Drupal 需要与断点进行交互时才需要将 CSS 断点写到 <code>*.breakpoints.yml</code> 文件中，例如在使用“响应式图像”模块的情况下。</p>
</blockquote>
<p>主题和模块可以通过创建一个名为 <code>*.breakpoints.yml</code> 的配置文件来定义断点。该文件中每一块内容代表一个断点，每个断点包括一个标识符，例如 <code>bartik.mobile</code>，随后是定义这个断点的属性：</p>
<ol>
<li><code>label</code>：断点的标签</li>
<li><code>mediaQuery</code>：媒体查询语句</li>
<li><code>weight</code>：断点的权重（顺序）</li>
<li><code>multipliers</code>：支持的像素分辨率乘数</li>
</ol>
<p>最小 <code>min-width</code> 的断点应具有最小的权重，而最大 <code>min-width</code> 的断点应具有较大的权重。默认情况下，模块将按从最小到最大的顺序对断点进行排序，即移动端优先的原则。</p>
<p>断点可以进行分组。例如布局断点和图像断点分开，详细使用方法去看文档。</p>
<h2 id="使用-twig-模板"><a class="markdownIt-Anchor" href="#使用-twig-模板"></a> 使用 Twig 模板</h2>
<p>Twig 模板的使用方法参考：<a target="_blank" rel="noopener" href="https://symfony.com/doc/current/templates.html">Creating and Using Templates</a></p>
<h3 id="twig-基本语法"><a class="markdownIt-Anchor" href="#twig-基本语法"></a> Twig 基本语法</h3>
<h4 id="变量"><a class="markdownIt-Anchor" href="#变量"></a> 变量</h4>
<ol>
<li>定义变量</li>
</ol>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">set</span></span> foo = &#x27;foo&#x27; %&#125;</span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">set</span></span> foo = [1, 2] %&#125;</span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">set</span></span> foo = &#123;&#x27;foo&#x27;: &#x27;bar&#x27;&#125; %&#125;</span><br></code></pre></td></tr></table></figure>
<p>调用变量：<code>&#123;&#123; foo.bar &#125;&#125;</code></p>
<ol start="2">
<li>Filter</li>
</ol>
<p>变量可以通过过滤器修改，类似于 shell，通过“|”管道符分隔。可以链接多个过滤器，一个过滤器的输出将作为下一个过滤器的输入</p>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="hljs-template-variable">&#123;&#123; name|<span class="hljs-keyword">striptags</span>|<span class="hljs-keyword">title</span> &#125;&#125;</span><br><span class="hljs-template-variable">&#123;&#123; list|<span class="hljs-keyword">join</span>(&#x27;, &#x27;) &#125;&#125;</span><span class="xml"> </span><span class="hljs-comment">&#123;# 带参数的形式 #&#125;</span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">apply</span></span> upper %&#125;</span><span class="xml">     </span><span class="hljs-comment">&#123;# 在代码段上应用过滤器 #&#125;</span><br><span class="xml">    This text becomes uppercase</span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">endapply</span></span> %&#125;</span><br></code></pre></td></tr></table></figure>
<h4 id="函数"><a class="markdownIt-Anchor" href="#函数"></a> 函数</h4>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">for</span></span> i in <span class="hljs-name">range</span><span class="hljs-params">(0, 3)</span> %&#125;</span><span class="xml">	</span><span class="hljs-comment">&#123;# 普通形式 #&#125;</span><br><span class="xml">    </span><span class="hljs-template-variable">&#123;&#123; i &#125;&#125;</span><span class="xml">,</span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">endfor</span></span> %&#125;</span><br><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">for</span></span> i in <span class="hljs-name">range</span><span class="hljs-params">(low=1, high=10, step=2)</span> %&#125;</span><span class="xml">	</span><span class="hljs-comment">&#123;# 命名参数形式 #&#125;</span><br><span class="xml">    </span><span class="hljs-template-variable">&#123;&#123; i &#125;&#125;</span><span class="xml">,</span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">endfor</span></span> %&#125;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>注：命名参数还可以用来跳过一些不想更改其默认值的参数</p>
</blockquote>
<h4 id="控制结构"><a class="markdownIt-Anchor" href="#控制结构"></a> 控制结构</h4>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">if</span></span> users|<span class="hljs-keyword">length</span> &gt; 0 %&#125;</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="xml">        </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">for</span></span> user in users %&#125;</span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123; user.username|e &#125;&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="xml">        </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">endfor</span></span> %&#125;</span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">endif</span></span> %&#125;</span><br></code></pre></td></tr></table></figure>
<h4 id="引用其他模板"><a class="markdownIt-Anchor" href="#引用其他模板"></a> 引用其他模板</h4>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">include</span><span class="hljs-params">(&#x27;sections/articles/sidebar.html&#x27;)</span> &#125;&#125;</span><br></code></pre></td></tr></table></figure>
<h4 id="模板继承"><a class="markdownIt-Anchor" href="#模板继承"></a> 模板继承</h4>
<p>模板继承使您可以构建基本的“骨架”模板，该模板包含站点的所有常见元素，并定义子模板可以覆盖的 <code>block</code></p>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml">        </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">block</span></span> head %&#125;</span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;style.css&quot;</span> /&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span></span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">block</span></span> title %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">endblock</span></span> %&#125;</span><span class="xml"> - My Webpage<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="xml">        </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">endblock</span></span> %&#125;</span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span></span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">block</span></span> content %&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">endblock</span></span> %&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;footer&quot;</span>&gt;</span></span><br><span class="xml">            </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">block</span></span> footer %&#125;</span><br><span class="xml">                <span class="hljs-symbol">&amp;copy;</span> Copyright 2011 by <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://domain.invalid/&quot;</span>&gt;</span>you<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.</span><br><span class="xml">            </span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">endblock</span></span> %&#125;</span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<p>子模版：</p>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">extends</span></span> &quot;base.html&quot; %&#125;</span><br><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">block</span></span> title %&#125;</span><span class="xml">Index</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">endblock</span></span> %&#125;</span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">block</span></span> head %&#125;</span><br><span class="xml">    </span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">parent</span><span class="hljs-params">()</span> &#125;&#125;</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="xml">        .important &#123; color: #336699; &#125;</span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">endblock</span></span> %&#125;</span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">block</span></span> content %&#125;</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Index<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;important&quot;</span>&gt;</span></span><br><span class="xml">        Welcome to my awesome homepage.</span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">endblock</span></span> %&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="调试-twig-模板"><a class="markdownIt-Anchor" href="#调试-twig-模板"></a> 调试 Twig 模板</h3>
<p>调试 Twig 模板有两种方法：使用 Devel 模块或者使用 twig_xdebug 模块配合 xdebug 调试。Devel 主要用来检查Twig 模板的变量，实际调试过程中，还是 xdebug 好用，因为可以在 IDE 中查看变量和调用栈。因此我选择主要用 xdebug 进行调试，Devel 辅助查看变量。</p>
<p>使用 xdebug 调试 Twig 需要的步骤：</p>
<ol>
<li>
<p>安装 xdebug 并在 php.ini 中开启：</p>
<ul>
<li>把 <code>phpinfo()</code> 输出的信息复制到 <a target="_blank" rel="noopener" href="https://xdebug.org/wizard">https://xdebug.org/wizard</a> 获取安装方式</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">zend_extension</span>=D:\xampp\php\ext\php_xdebug-<span class="hljs-number">2.9</span>.<span class="hljs-number">4</span>-<span class="hljs-number">7.4</span>-vc15-x<span class="hljs-number">86_64</span>.dll<br><br><span class="hljs-section">[xDebug]</span><br><span class="hljs-attr">xdebug.remote_enable</span>=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>启动之后，xdebug 默认监听 <code>127.0.0.1:9000</code></p>
</li>
<li>
<p>浏览器安装 Xdebug Helper (Google Chrome &amp; Firefox)</p>
</li>
<li>
<p>安装 <code>twig_xdebug</code> 模块并开启</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">composer require --dev drupal/twig_xdebug<br>drush en -y twig_xdebug<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>在 twig 文件中使用 <code>{{ breakpoint() }}</code></p>
</li>
<li>
<p>如果需要使用 <code>dump()</code> 函数检查变量，则需要本地开启 <code>debug</code> 模式：<code>drupal site:mode dev</code></p>
</li>
</ol>
<blockquote>
<p>注意：经过测试，使用 <code>drupal site:mode dev</code> 之后，还是需要 <code>drupal cr</code> 才能看到效果，使用 <a target="_blank" rel="noopener" href="https://www.drupal.org/node/2598914">Disable Drupal 8 caching during development</a> 的第一种方法即使用“settings.local.php”的方法在当前版本（version 8.8.5）确认有效</p>
</blockquote>
<h3 id="twig模板命名约定"><a class="markdownIt-Anchor" href="#twig模板命名约定"></a> Twig模板命名约定</h3>
<ul>
<li>
<p>HTML 模板：<em>html.html.twig</em> (core/modules/system/templates/html.html.twig)</p>
<blockquote>
<p>提供 HTML 页面基本结构的标记，包括 <code>&lt;head&gt;</code>，<code>&lt;title&gt;</code> 和 <code>&lt;body&gt;</code> 标记</p>
</blockquote>
</li>
<li>
<p>Page 模板：<em>page.html.twig</em> (core/modules/system/templates/page.html.twig)</p>
<blockquote>
<p>提供每个单独页面的模板，比如首页：<code>page--front.html.twig</code></p>
<p>匹配模式：<em>page–[front|internal/path].html.twig</em></p>
</blockquote>
</li>
<li>
<p>Regions 模板：<em>region.html.twig</em> (core/modules/system/templates/region.html.twig)</p>
<blockquote>
<p>匹配模式：<em>region–[region].html.twig</em></p>
</blockquote>
</li>
<li>
<p>Blocks 模板：<em>block.html.twig</em> (core/modules/block/templates/block.html.twig)</p>
<blockquote>
<p>匹配模式：<em>block–[module|–[delta].html.twig</em></p>
</blockquote>
</li>
<li>
<p>Nodes 模板：<em>node.html.twig</em> (core/modules/node/templates/node.html.twig)</p>
<blockquote>
<p>匹配模式：<em>node–[content-type|nodeid]–[viewmode].html.twig</em></p>
</blockquote>
</li>
<li>
<p>Taxonomy terms 模板：<em>taxonomy-term.html.twig</em> (core/modules/taxonomy/templates/taxonomy-term.html.twig)</p>
<blockquote>
<p>匹配模式：<em>taxonomy-term–[vocabulary-machine-name|tid].html.twig</em></p>
</blockquote>
</li>
<li>
<p>Fields 模板：<em>field.html.twig</em> (core/modules/system/templates/field.html.twig)</p>
<blockquote>
<p>匹配模式：<em>field–[[type|name]|[entity-type]–[field-name|content-type]].html.twig</em></p>
</blockquote>
</li>
<li>
<p>Comments 模板：<em>comment.html.twig</em> (core/modules/comment/templates/comment.html.twig)</p>
<blockquote>
<p>匹配模式：<em>comment–[comment-field-name]–[node-type].html.twig</em></p>
</blockquote>
</li>
<li>
<p>Views 模板：views-view.html.twig (core/themes/stable/templates/views/views-view.html.twig)</p>
<blockquote>
<p>匹配模式： views-view–[<em>viewid</em>]–[<em>view-display-id</em>].html.twig</p>
<p>​					views-view–[<em>viewid</em>]–[<em>view-display-type</em>].html.twig</p>
<p>​					views-view–[<em>view-display-type</em>].html.twig</p>
<p>​					views-view–[<em>viewid</em>].html.twig</p>
</blockquote>
</li>
</ul>
<p>另外还有 Forums、Maintenance Page、Search result 等页面的模板。</p>
<blockquote>
<p>注：添加模板后，必须重新构建缓存，以使 Drupal 使用新模板：<code>drush cr</code></p>
</blockquote>
<h3 id="覆盖模板"><a class="markdownIt-Anchor" href="#覆盖模板"></a> 覆盖模板</h3>
<p>为了覆盖已有的模板，需要：</p>
<ul>
<li>找到想要覆盖的模板文件；</li>
<li>将模板文件从其原本位置复制到对应主题内；</li>
<li>按需修改模板。</li>
</ul>
<p>有时只需要覆盖模板的某一部分内容，这时可以使用 Theme hook suggestions：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Render!theme.api.php/function/hook_theme_suggestions_HOOK/8"><code>hook_theme_suggestions_HOOK(array $variables)</code></a></li>
<li><a target="_blank" rel="noopener" href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Render!theme.api.php/function/hook_theme_suggestions_alter/8"><code>hook_theme_suggestions_alter(array &amp;$suggestions, array $variables, $hook)</code></a></li>
<li><a target="_blank" rel="noopener" href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Render!theme.api.php/function/hook_theme_suggestions_HOOK_alter/8"><code>hook_theme_suggestions_HOOK_alter(array &amp;$suggestions, array $variables)</code></a></li>
</ul>
<h3 id="模板中使用属性对象"><a class="markdownIt-Anchor" href="#模板中使用属性对象"></a> 模板中使用属性对象</h3>
<p>许多 Twig 模板具有一个或多个作为变量传递的属性对象。默认情况下，以下属性对象变量可用于所有模板：<code>attributes</code>，<code>title_attributes</code> 和 <code>content_attributes</code></p>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="xml">&lt;div</span><span class="hljs-template-variable">&#123;&#123; attributes &#125;&#125;</span><span class="xml">&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<p>常用方法：</p>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="xml">attributes.addClass()</span><br><span class="xml">attributes.removeClass()</span><br><span class="xml">attributes.setAttribute($attribute, $value)</span><br><span class="xml">attributes.removeAttribute($attribute)</span><br><span class="xml">attributes.hasClass($class)</span><br></code></pre></td></tr></table></figure>
<p>创建一个新的属性对象：</p>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="xml">&lt;div</span><span class="hljs-template-variable">&#123;&#123; create_attribute(&#123;&#x27;class&#x27;: [&#x27;region&#x27;, &#x27;region--header&#x27;]&#125;) &#125;&#125;</span><span class="xml">&gt;</span><br><span class="xml">  </span><span class="hljs-template-variable">&#123;&#123; content &#125;&#125;</span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<p>可以在 <code>.theme</code> 文件中对属性对象进行预处理或者修改：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* Implements hook_preprocess_HOOK() for menu.html.twig.</span><br><span class="hljs-comment">*/</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mytheme_preprocess_menu</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$variables</span></span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">$variables</span>[<span class="hljs-string">&#x27;menu_name&#x27;</span>] == <span class="hljs-string">&#x27;main&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$variables</span>[<span class="hljs-string">&#x27;attributes&#x27;</span>][<span class="hljs-string">&#x27;class&#x27;</span>])) &#123;<br>      <span class="hljs-variable">$variables</span>[<span class="hljs-string">&#x27;attributes&#x27;</span>][<span class="hljs-string">&#x27;class&#x27;</span>] = [];<br>    &#125;<br>    <span class="hljs-variable">$variables</span>[<span class="hljs-string">&#x27;attributes&#x27;</span>][<span class="hljs-string">&#x27;class&#x27;</span>] = array_merge(<span class="hljs-variable">$variables</span>[<span class="hljs-string">&#x27;attributes&#x27;</span>][<span class="hljs-string">&#x27;class&#x27;</span>], [<span class="hljs-string">&#x27;my-main-menu&#x27;</span>]);  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="创建高级主题设置"><a class="markdownIt-Anchor" href="#创建高级主题设置"></a> 创建高级主题设置</h2>
<p>高级主题设置即在“管理/外观/设置”里面对应主题名的设置页面，通常由 <code>THEME.theme</code> 或者 <code>theme-settings.php</code> 两个文件来进行控制，使用 <strong>Forms API</strong> 添加需要进行设置的项目。以 <code>THEMENAME_form_system_theme_settings_alter(&amp;$form, $form_state)</code> 为例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo_form_system_theme_settings_alter</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$form</span>, \Drupal\Core\Form\FormStateInterface <span class="hljs-variable">$form_state</span>, <span class="hljs-variable">$form_id</span> = <span class="hljs-literal">NULL</span></span>) </span>&#123;<br>  <span class="hljs-comment">// Work-around for a core bug affecting admin themes. See issue #943212.</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$form_id</span>)) &#123;<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br><br>  <span class="hljs-variable">$form</span>[<span class="hljs-string">&#x27;foo_example&#x27;</span>] = <span class="hljs-keyword">array</span>(<br>    <span class="hljs-string">&#x27;#type&#x27;</span>          =&gt; <span class="hljs-string">&#x27;textfield&#x27;</span>,<br>    <span class="hljs-string">&#x27;#title&#x27;</span>         =&gt; t(<span class="hljs-string">&#x27;Widget&#x27;</span>),<br>    <span class="hljs-string">&#x27;#default_value&#x27;</span> =&gt; theme_get_setting(<span class="hljs-string">&#x27;foo_example&#x27;</span>),<br>    <span class="hljs-string">&#x27;#description&#x27;</span>   =&gt; t(<span class="hljs-string">&quot;Place this text in the widget spot on your site.&quot;</span>),<br>  );<br>&#125;<br></code></pre></td></tr></table></figure>
<p>默认值需要定义在 <code>config/install/THEME.settings.yml</code> 文件中：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">foo_example:</span> <span class="hljs-string">default</span> <span class="hljs-string">value</span><br></code></pre></td></tr></table></figure>
<p>随后在所有主题的 PHP 文件中，可通过：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$foo_example</span> = theme_get_setting(<span class="hljs-string">&#x27;foo_example&#x27;</span>);<br></code></pre></td></tr></table></figure>
<p>获取这个值，如果需要在 Twig 文件中使用，需要先在 <code>THEME.theme</code> 文件中定义：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo_preprocess_node</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$variables</span></span>) </span>&#123;<br>  <span class="hljs-variable">$variables</span>[<span class="hljs-string">&#x27;foo_example&#x27;</span>] = theme_get_setting(<span class="hljs-string">&#x27;foo_example&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>之后就可以在 Twig 文件中直接使用 <code>&#123;&#123; foo_example &#125;&#125;</code> 获取变量值</p>
<h1 id="附录1常用命令"><a class="markdownIt-Anchor" href="#附录1常用命令"></a> 附录1：常用命令</h1>
<ul>
<li>安装 Drupal</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">composer create-project drupal/recommended-project ./dir-name<br></code></pre></td></tr></table></figure>
<ul>
<li>安装 drush</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">composer require drush/drush<br></code></pre></td></tr></table></figure>
<ul>
<li>更新模块</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">composer outdated &#x27;drupal/*&#x27; # 检查可更新模块<br>composer update drupal/modulename --with-dependencies # 更新对应模块<br><br>drush updatedb<br>drush cache:rebuild<br>drush config:export --diff # 更新数据库、重建缓存同时导出可能更改的配置<br></code></pre></td></tr></table></figure>
<ul>
<li>列出已安装模块</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">composer [global] show -i<br></code></pre></td></tr></table></figure>
<ul>
<li>快速创建 Drupal 实例</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">php ./core/scripts/drupal quick-start PROFILE<br></code></pre></td></tr></table></figure>
<h1 id="附录2实用技巧"><a class="markdownIt-Anchor" href="#附录2实用技巧"></a> 附录2：实用技巧</h1>
<ul>
<li>在 JS 中判断当前页面是否为主页：</li>
</ul>
<p>先在 <code>* .libraries.yml</code> 文件中加载 <code>drupalSettings</code>：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">js:</span><br>  <span class="hljs-attr">js/main.js:</span> &#123;&#125;<br><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">core/jquery</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">core/drupalSettings</span><br></code></pre></td></tr></table></figure>
<p>然后在 JS 文件中调用 <code>drupalSettings.path.isFront</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$, drupalSettings</span>) </span>&#123;<br>	<span class="hljs-built_in">console</span>.log(drupalSettings.path.isFront);<br>&#125;)(jQuery, drupalSettings);<br></code></pre></td></tr></table></figure>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a>
                    
                      <a class="hover-with-bg" href="/categories/%E5%90%8E%E7%AB%AF/PHP/">PHP</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/CMS/">CMS</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/12/03/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86%E9%97%AE%E9%A2%98/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">二叉树的遍历问题</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/03/03/%E7%BB%99%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0Live2D%E7%9C%8B%E6%9D%BF%E5%A8%98/">
                        <span class="hidden-mobile">给博客添加Live2D看板娘</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    Fluid.utils.lazyComments('vcomments', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "3thvlRFEaPVQpJJtlrogRwP8-gzGzoHsz",
          app_key: "QueqTwpRD1mNqEskFmbaAdx1",
          placeholder: "说点什么",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "zh-CN",
          highlight: false,
          recordIP: false,
          serverURLs: "",
        });
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the
    <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a>
  </noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
